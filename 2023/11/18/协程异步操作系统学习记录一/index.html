
<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8" />
        <title>协程异步操作系统-学习记录一 | ⭐星雨起源⭐</title>
        <meta name="author" content="海画沙夢w" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <link rel="icon" href="/images/favicon.png" />
        <link rel="preconnect" href="https://cdn.staticfile.org" />
<script src="https://cdn.staticfile.org/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.org/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://cdn.staticfile.org/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://cdn.staticfile.org/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
                <div id="loading" v-show="loading">
                    <div id="loading-circle">
                        <h2>LOADING</h2>
                        <p>加载过慢请开启缓存 浏览器默认开启</p>
                        <img src="/images/loading.gif" />
                    </div>
                </div>
            </transition>
            <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>⭐星雨起源⭐</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;⭐星雨起源⭐</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

            <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
                <div class="article">
    <div>
        <h1>协程异步操作系统-学习记录一</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/11/18
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/rCore/" style="color: #00bcd4">rCore</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="color: #ff7d73">操作系统</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/OS/" style="color: #ffa2c4">OS</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/async/" style="color: #ff7d73">async</a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/future/" style="color: #00bcd4">future</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h2 id="用户态中断"><a href="#用户态中断" class="headerlink" title="用户态中断"></a>用户态中断</h2><p>用户态中断（User Interrupt）指的是能够在用户态注册中断处理函数，并且也能够在用户态触发指定的中断处理函数。</p>
<p>相关内容：<a target="_blank" rel="noopener" href="https://0x10.sh/user-interrupt">0x10.sh&#x2F;user-interrupt</a></p>
<h3 id="其他相关资料"><a href="#其他相关资料" class="headerlink" title="其他相关资料"></a>其他相关资料</h3><p><a target="_blank" rel="noopener" href="https://gallium70.github.io/rv-n-ext-impl/ch1_3_x86_uintr.html">x86 用户态中断 - Risc-V Extension N Implementation (gallium70.github.io)</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/499388903">用户态中断 - 知乎 (zhihu.com)</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/414262726">新CPU特性 - User space interrupt - 知乎 (zhihu.com)</a></p>
<h2 id="CPU硬件、操作系统对并发的支持"><a href="#CPU硬件、操作系统对并发的支持" class="headerlink" title="CPU硬件、操作系统对并发的支持"></a>CPU硬件、操作系统对并发的支持</h2><h3 id="单核情况下"><a href="#单核情况下" class="headerlink" title="单核情况下"></a>单核情况下</h3><ol>
<li><strong>时间片轮转</strong>：把CPU时间分割成很小的片段，然后轮流分配给各个运行中的进程使用。每个进程在被分配到一个时间片后，会执行一段时间的任务，然后让出CPU，接着下一个进程获得时间片并执行。这样，虽然在任何一个时刻，CPU只被一个进程使用，但由于时间片的切换速度非常快，使得人们感觉所有的进程都在同时运行。</li>
<li><strong>中断技术</strong>：当CPU正在执行一个进程时，如果发生了中断（比如I&#x2F;O请求、时钟中断等），CPU会暂停当前进程的执行，转而去处理中断请求。处理完中断后，CPU再回到被中断的进程继续执行。这种技术可以保证高优先级的任务（如I&#x2F;O处理）能及时得到CPU的处理，从而提高了系统的响应速度和并发性。</li>
</ol>
<h3 id="多核情况下（对多任务处理）"><a href="#多核情况下（对多任务处理）" class="headerlink" title="多核情况下（对多任务处理）"></a>多核情况下（对多任务处理）</h3><p>在单核CPU中，多个线程或进程是并发执行的，即在同一时间段内交替运行，但在任一时刻只有一个线程或进程在执行。</p>
<p>在多核CPU中，可以实现并行执行，即在同一时刻，多个线程或进程在不同的核心上同时执行。一个线程只能挂在一个核上，并且每个核上的所有线程按照时间片轮转调度。</p>
<p>对于计算密集型任务，可以使用核心数个线程，就可以占满CPU资源，进而可以充分利用CPU。对于IO密集型任务（涉及到网络、磁盘IO的任务都是IO密集型任务），线程由于被IO阻塞，如果仍然用核心数个线程，CPU是跑不满的，于是可以使用更多个线程来提高CPU使用率。</p>
<p>既然有多个核心，那么当一个被正在运行的核挂起的线程可以在另一个核上继续运行。不过如果这种任务迁移非常频繁，实际上是对性能有害的，一般操作系统不会频繁地迁移任务。</p>
<p>同时每个核都有自己的缓存，需要一种机制来保证缓存的一致性。这通常通过缓存一致性协议（如MESI协议）来实现。</p>
<h3 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h3><p>个人理解，操作系统主要是如何更有效地利用CPU，以及负责调度上的问题。</p>
<p><strong>多进程：</strong>操作系统可以创建多个进程，每个进程独立运行，拥有自己的地址空间和资源。这些进程可以并发执行，即在同一时间段内交替运行。</p>
<p><strong>多线程：</strong>在一个进程内部，可以创建多个线程，这些线程共享进程的资源，但可以并发执行。这样，一个进程内的多个线程可以同时执行不同的任务。</p>
<p><strong>中断机制：</strong>操作系统使用中断机制来响应外部设备的请求，如键盘输入、鼠标点击等。当外部设备发出中断请求时，CPU会暂停当前任务，转而处理中断请求。处理完中断请求后，CPU再回到被中断的任务继续执行。</p>
<p><strong>时间片轮转：</strong>操作系统将CPU的运行时间划分为多个小的时间片，并依次分配给每个线程或进程。每个线程（或进程）在所分配的时间片内运行，当时间片用完后，系统内核会剥夺该线程（或进程）的CPU执行权，并将“执行权”交给下一个等待执行的线程或进程。</p>
<p><strong>硬件上下文切换：</strong>为了实现多道程序的分时共享，内核必须使用硬件上下文切换机制。当一个进程的时间片耗尽，内核会保存该进程的状态（即上下文），然后加载另一个进程的上下文，使得CPU可以继续执行新的进程。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="电路并行"><a href="#电路并行" class="headerlink" title="电路并行"></a>电路并行</h4><p>在搜集整理资料的过程中发现一个问题，在物理上，电路本身就是并行的，并行是电路的天然属性。例子有FPGA<br>也许可以从其实现中获得更多启发，但本人未进行深入研究。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><strong>轮询，硬件怎么做，为什么硬件做效率更高？</strong></p>
<p><strong>轮询：</strong></p>
<p>轮询是一种CPU决策如何提供周边设备服务的方式。<br>在轮询过程中，由CPU定时发出询问，依序询问每一个周边设备是否需要其服务。<br>每个设备都有一个指示命令就绪的位，指示该设备的状态。<br>当此状态就绪即给予服务，服务结束后再问下一个周边，接着不断周而复始。</p>
<p>硬件轮询是由硬件直接进行的，它可以在硬件级别上快速检查设备状态，而无需占用CPU资源。</p>
<p>这种方式在处理高频请求或大量数据请求的设备时，效率更高。</p>
<p>硬件轮询可以减少系统的复杂性，因为它不需要复杂的中断处理和优先级管理。</p>
<p><strong>有用户态中断之前，程序死循环了，怎么让它停下来。Ctrl + C是怎么做到的？</strong></p>
<p>终端在接收到Ctrl + C后向前台进程发送SIGINT信号，而进程通常会在接收到这个信号后终止</p>
<p>相关资料：</p>
<p>关于硬件中断：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/360548214">一文讲透计算机的“中断”</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/163195429">选中断还是轮询方式？深究其中的区别</a></p>
<h2 id="编程语言对并发的支持"><a href="#编程语言对并发的支持" class="headerlink" title="编程语言对并发的支持"></a>编程语言对并发的支持</h2><p>当今常用的编程语言几乎均原生自带一套实现并发的方案，同时三方库也会提供很多很多的并发方式。</p>
<p>相关资料：</p>
<p><a target="_blank" rel="noopener" href="https://www.bmpi.dev/dev/deep-in-program-language/how-to-implement-concurrency/concurrency-model/">编程语言是如何实现并发的之并发模型篇 · BMPI</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/362843892">JAVA并发编程知识总结（全是干货超详细）</a></p>
<h2 id="异步与操作系统"><a href="#异步与操作系统" class="headerlink" title="异步与操作系统"></a>异步与操作系统</h2><p>见学习记录二</p>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2023 - 2024 ⭐星雨起源⭐
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;海画沙夢w
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            
            <transition name="fade">
                <div id="preview" ref="preview" v-show="previewShow">
                    <img id="preview-content" ref="previewContent" />
                </div>
            </transition>
            
        </div>



        <script src="/js/main.js">  </script>
        <script>
            console.info("Welcome to Argvchs' blog!");
            if (!window.hasOwnProperty("ontouchstart")) {
                let html = '<canvas id="fireworks" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"></canvas><script src="https://static-argvchs.netlify.app/js/fireworks.min.js"><\/script>';
                document.body.append(document.createRange().createContextualFragment(html));
            }
        </script>


        <!-- 鼠标点击特效 -->
        <canvas
            id="fireworks"
            style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
        ></canvas>
        <script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>
        <script src="/js/fireworks.min.js"></script>



        <!-- 鼠标指针特效 -->
        <div id="cursor"></div>
        <link rel="stylesheet" href="/css/cursor.min.css" />
        <script src="/js/cursor.min.js"></script>



        <!-- 流星背景特效 -->
        <canvas
            id="background"
            style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"
        ></canvas>
        <script src="/js/background.min.js"></script>




       



        
        
<script
    src="https://giscus.app/client.js"
    data-repo="StaRainorigin/StaRainorigin.github.io"
    data-repo-id="R_kgDOH6wiAg"
    data-category="General"
    data-category-id="DIC_kwDOH6wiAs4CY_KG"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="https://static-argvchs.netlify.app/css/giscus.css"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
